define(["jquery","core/ajax","core/notification","core/str"],function(a,b,c,d){var e,f,g,h,i,j={UPLOADER:"#course_image_uploader",HEADER:"#page-header .header-body",HEADER_TOP:"#page-header .page-head",UPLOAD_BTN:"#upload_img_confirm",CANCEL_BTN:"#upload_img_cancel"},k=function(b,c,d){e=a(b),f=c,g=d},l=function(a){h=a},m=function(a){i=a},n=function(){e.on("change",j.UPLOADER,o),e.on("click",j.UPLOAD_BTN,q),e.on("click",j.CANCEL_BTN,s)},o=function(a){if(a.target.files.length){var b=a.target.files[0];if(!b.type.match("image.*"))return void d.get_string("error:courseimageinvalidfiletype","theme_urcourses_default").done(t);if(b.size>f)return void d.get_string("error:courseimageexceedsmaxbytes","theme_urcourses_default",v(f)).done(t);m(b.name);var c=new FileReader;c.onload=p,c.readAsDataURL(b)}},p=function(b){var c=b.target.result;a(j.HEADER).data("original_img",a(j.HEADER).css("background-image")),a(j.HEADER).css({"background-image":"url("+c+")"}),e.addClass("confirm"),c=c.split("base64,")[1],l(c)},q=function(){if(h&&i&&g){var a={courseid:g,imagedata:h,imagename:i},d={methodname:"theme_urcourses_default_upload_course_image",args:a,done:r,fail:c.exception};b.call([d])}},r=function(){l(""),m(""),e.removeClass("confirm"),a(j.HEADER).data("original_image",""),d.get_string("success:courseimageuploaded","theme_urcourses_default").done(u)},s=function(){l(""),m("");var b=a(j.HEADER).data("original_img");a(j.HEADER).css({"background-image":b}),e.removeClass("confirm")},t=function(b){var c=a("<div></div>");c.text(b),c.css({position:"absolute"}),c.css({right:"5px"}),c.addClass("alert alert-danger alert-dismissable fade show");var d=a("<button></button>");d.html("&times;"),d.addClass("close"),d.attr("type","button"),d.attr("data-dismiss","alert"),c.append(d),a(j.HEADER_TOP).append(c)},u=function(b){var c=a("<div></div>");c.text(b),c.css({position:"absolute"}),c.css({right:"5px"}),c.addClass("alert alert-success alert-dismissable fade show");var d=a("<button></button>");d.html("&times;"),d.addClass("close"),d.attr("type","button"),d.attr("data-dismiss","alert"),c.append(d),a(j.HEADER_TOP).append(c)},v=function(a){var b=Math.floor(Math.log(a)/Math.log(1024));return 1*(a/Math.pow(1024,b)).toFixed(2)+" "+["B","KB","MB","GB","TB"][b]},w=function(a,b,c){k(a,b,c),n()};return{init:w}});