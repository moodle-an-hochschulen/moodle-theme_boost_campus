define(["jquery","core/ajax","core/notification","core/str","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){var g,h,i,j,k,l={UPLOADER:"#course_image_uploader",HEADER:"#page-header .header-body",HEADER_TOP:"#page-header .page-head",SQUARE_IMG:"#hdr_chooser_a_div",STYLE_HDR:"#header_a_head",UPLOAD_BTN:"#upload_img_confirm",CANCEL_BTN:"#upload_img_cancel"},m=function(b,c,d){g=a(b),h=c,i=d},n=function(a){j=a},o=function(a){k=a},p=function(){g.on("change",l.UPLOADER,q),g.on("click",l.UPLOAD_BTN,s),g.on("click",l.CANCEL_BTN,u)},q=function(a){if(a.target.files.length){var b=a.target.files[0];if(!b.type.match("image.*"))return void d.get_string("error:courseimageinvalidfiletype","theme_urcourses_default").done(v);if(b.size>h)return void d.get_string("error:courseimageexceedsmaxbytes","theme_urcourses_default",x(h)).done(v);o(b.name);var c=new FileReader;c.onload=r,c.readAsDataURL(b)}},r=function(b){var c=b.target.result,d=a(l.STYLE_HDR).length>0?l.SQUARE_IMG:l.HEADER;a(d).data("original_img",a(d).css("background-image")),a(l.SQUARE_IMG).css({"background-image":"url("+c+")"}),a(l.HEADER).css({"background-image":"url("+c+")"}),g.addClass("confirm"),c=c.split("base64,")[1],n(c)},s=function(){if(j&&k&&i){var a={courseid:i,imagedata:j,imagename:k},d={methodname:"theme_urcourses_default_upload_course_image",args:a,done:t,fail:c.exception};b.call([d])}},t=function(){n(""),o(""),g.removeClass("confirm"),a(l.HEADER).data("original_image",""),a(l.UPLOADER).val(""),d.get_string("success:courseimageuploaded","theme_urcourses_default").done(w)},u=function(){n(""),o("");var b=a(l.HEADER).data("original_img");a(l.SQUARE_IMG).css({"background-image":b}),a(l.HEADER).css({"background-image":b}),a(l.UPLOADER).val(""),g.removeClass("confirm"),a(l.HEADER).data("original_image","")},v=function(b){var c=a("<div></div>");c.text(b),c.css({position:"absolute"}),c.css({left:"5px"}),c.css({bottom:"30px"}),c.addClass("alert alert-danger alert-dismissable fade show");var d=a("<button></button>");d.html("&times;"),d.addClass("close"),d.attr("type","button"),d.attr("data-dismiss","alert"),c.append(d),a(l.HEADER_TOP).append(c)},w=function(b){var c=a("<div></div>");c.text(b),c.prop("id","cimage_success_popup"),c.css({position:"absolute"}),c.css({left:"5px"}),c.css({bottom:"30px"}),c.addClass("alert alert-success alert-dismissable fade show");var d=a("<button></button>");d.html("&times;"),d.addClass("close"),d.attr("type","button"),d.attr("data-dismiss","alert"),c.append(d),a(l.HEADER_TOP).append(c),setTimeout(function(){a("#cimage_success_popup").fadeTo(500,0).slideUp(500,function(){a(this).remove()})},1800)},x=function(a){var b=Math.floor(Math.log(a)/Math.log(1024));return 1*(a/Math.pow(1024,b)).toFixed(2)+" "+["B","KB","MB","GB","TB"][b]},y=function(a,b,c){m(a,b,c),p()};return{init:y}});